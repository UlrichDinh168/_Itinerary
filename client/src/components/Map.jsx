import React, { useRef, useEffect, useState } from 'react';
import mapboxgl from '!mapbox-gl'; // eslint-disable-line import/no-webpack-loader-syntax
import polyline from '@mapbox/polyline'

const REACT_APP_MAPBOX_TOKEN = process.env.REACT_APP_MAPBOX_TOKEN;
mapboxgl.accessToken = REACT_APP_MAPBOX_TOKEN

// console.log(process.env.REACT_APP_MAPBOX_TOKEN, 'process.env.TOKEN');
const points = [
  [
    24.82435,
    60.21074
  ],
  [
    24.82438,
    60.21074
  ],
  [
    24.82472,
    60.2107
  ],
  [
    24.82503,
    60.21065
  ],
  [
    24.82509,
    60.21074
  ],
  [
    24.82496,
    60.21076
  ],
  [
    24.8244,
    60.21083
  ]
]
export default function App({ points }) {
  // c|nnJeoovC?EFcAH}@QKCXMnB
  const polylines = polyline.toGeoJSON('a|nnJaoovCe@vFUpBSf@uErIOTQZWp@ObAEx@AdBAlBIzDA~EC`EAnBG|AMbBGx@G^ObAOj@Qp@c@zA[lAkAzE~@|@RPPJTB\\INUz@sBnCoHh@uAJELQNQVER?XNvBbB`@Lz@t@x@l@^l@Jh@~EvGfCrDpAlApAp@vKNj@ELF@XJr@@DVhGXxFDnADxAR~CKt@cBbEKzAPrGVbAZ|@d@jAPdAHt@^|GXCdA]r@[JAp@C\\FlDnA`@DFCJ{DVsEl@{G`@gFPmD@QFsD`@Ar@FfAd@|@v@rAj@r@VzA`@RJb@\\Z^Zj@d@zAl@jAv@r@f@x@p@fB^nBR^VTz@VPTFf@Il@mArGG^AX@TD^\\vAZtBH|@Db@H\\Nj@Tt@b@lCLb@PXHD\\FJ@p@_@~A}@p@i@`BuBRSz@w@`A_@t@e@jA{@PATBv@x@LJHCXE^[bEsEhAsA^MXT~@l@v@Xl@Bb@@XG^Ob@Qd@_@h@e@X?NF^PfAd@rBfAxAr@dBx@|CxAnAr@pCnAbD|AZF~@Aj@Mf@e@pA_B`AwA\\g@vBoCbBwBbAmAfAcApA}@nAw@pBk@pBeArAo@lB}@rAo@bAe@n@[h@Qv@c@dCkAiAmSs@_Lu@uJ_@}CJ}@?q@G_@b@Uv@WdA]hBc@jBSJ?vAKt@@rGOvBIfAMtB]xAQXUHW@_@IoBKsBAoBCqHLcHLoFRiNJiG?aIN}GT}CRgEPgFX{Hp@oKv@gKz@oJ`AsHfDySRi@|@oEvAuKz@oIb@mHfGio@jFyh@pAuOPaEDmADeD?iC?kBG}EEkAIaB[_FWsCq@aGKq@mEg_@g@qEm@uFkAaOSwC_@qFgBu[}F_eAUyGKkGCyA@}CDoBHsFJ}BPcDZwDHkAf@iDVyAVqA~@cDt@kBh@eApAmBf@i@XSn@gAEiHGqEQ}UIiN_@{IUyHG}@SsCw@cDiAg@uB}@eCcAoCsAw@g@gBcGcAcE')

  console.log(polylines, 'polylines');


  const mapContainer = useRef(null);
  const mapRef = useRef(null);
  const [zoom, setZoom] = useState(11);
  useEffect(() => {
    if (mapRef.current) return; // initialize map only once
    mapRef.current = new mapboxgl.Map({
      container: mapContainer.current,
      style: 'mapbox://styles/mapbox/streets-v12',
      center: [24.82438, 60.21079],
      zoom: zoom
    });
    return () => {
      mapRef.current.remove();
    };
  }, []);

  console.log(points, 'points');
  console.log(mapRef.current && points.length > 1, 'mapRef.current && points.length > 1');
  useEffect(() => {
    if (mapRef.current && points?.length > 1) {
      // const coordinates = points.map(point => [point.from.lon, point.to.lat]);
      // console.log(coordinates, 'coordinates');

      const coordinates = [
        [
          24.82433,
          60.21073
        ],
        [
          24.82309,
          60.21092
        ],
        [
          24.82252,
          60.21103
        ],
        [
          24.82232,
          60.21113
        ],
        [
          24.82062,
          60.2122
        ],
        [
          24.82051,
          60.21228
        ],
        [
          24.82037,
          60.21237
        ],
        [
          24.82012,
          60.21249
        ],
        [
          24.81978,
          60.21257
        ],
        [
          24.81949,
          60.2126
        ],
        [
          24.81898,
          60.21261
        ],
        [
          24.81843,
          60.21262
        ],
        [
          24.81749,
          60.21267
        ],
        [
          24.81637,
          60.21268
        ],
        [
          24.8154,
          60.2127
        ],
        [
          24.81484,
          60.21271
        ],
        [
          24.81437,
          60.21275
        ],
        [
          24.81387,
          60.21282
        ],
        [
          24.81358,
          60.21286
        ],
        [
          24.81342,
          60.2129
        ],
        [
          24.81308,
          60.21298
        ],
        [
          24.81286,
          60.21306
        ],
        [
          24.81261,
          60.21315
        ],
        [
          24.81215,
          60.21333
        ],
        [
          24.81176,
          60.21347
        ],
        [
          24.81066,
          60.21385
        ],
        [
          24.81035,
          60.21353
        ],
        [
          24.81026,
          60.21343
        ],
        [
          24.8102,
          60.21334
        ],
        [
          24.81018,
          60.21323
        ],
        [
          24.81023,
          60.21308
        ],
        [
          24.81034,
          60.213
        ],
        [
          24.81092,
          60.2127
        ],
        [
          24.81244,
          60.21198
        ],
        [
          24.81287,
          60.21177
        ],
        [
          24.8129,
          60.21171
        ],
        [
          24.81299,
          60.21164
        ],
        [
          24.81308,
          60.21156
        ],
        [
          24.81311,
          60.21144
        ],
        [
          24.81311,
          60.21134
        ],
        [
          24.81303,
          60.21121
        ],
        [
          24.81253,
          60.21061
        ],
        [
          24.81246,
          60.21044
        ],
        [
          24.81219,
          60.21014
        ],
        [
          24.81196,
          60.20985
        ],
        [
          24.81173,
          60.20969
        ],
        [
          24.81152,
          60.20963
        ],
        [
          24.81012,
          60.20851
        ],
        [
          24.80922,
          60.20783
        ],
        [
          24.80883,
          60.20742
        ],
        [
          24.80858,
          60.20701
        ],
        [
          24.8085,
          60.20497
        ],
        [
          24.80853,
          60.20475
        ],
        [
          24.80849,
          60.20468
        ],
        [
          24.80836,
          60.20467
        ],
        [
          24.8081,
          60.20461
        ],
        [
          24.80807,
          60.2046
        ],
        [
          24.80674,
          60.20448
        ],
        [
          24.80549,
          60.20435
        ],
        [
          24.80509,
          60.20432
        ],
        [
          24.80464,
          60.20429
        ],
        [
          24.80384,
          60.20419
        ],
        [
          24.80357,
          60.20425
        ],
        [
          24.80259,
          60.20475
        ],
        [
          24.80213,
          60.20481
        ],
        [
          24.80075,
          60.20472
        ],
        [
          24.80041,
          60.2046
        ],
        [
          24.8001,
          60.20446
        ],
        [
          24.79972,
          60.20427
        ],
        [
          24.79937,
          60.20418
        ],
        [
          24.7991,
          60.20413
        ],
        [
          24.79767,
          60.20397
        ],
        [
          24.79769,
          60.20384
        ],
        [
          24.79784,
          60.20349
        ],
        [
          24.79798,
          60.20323
        ],
        [
          24.79799,
          60.20317
        ],
        [
          24.79801,
          60.20292
        ],
        [
          24.79797,
          60.20277
        ],
        [
          24.79757,
          60.2019
        ],
        [
          24.79754,
          60.20173
        ],
        [
          24.79756,
          60.20169
        ],
        [
          24.7985,
          60.20163
        ],
        [
          24.79956,
          60.20151
        ],
        [
          24.80098,
          60.20128
        ],
        [
          24.80214,
          60.20111
        ],
        [
          24.80301,
          60.20102
        ],
        [
          24.8031,
          60.20101
        ],
        [
          24.804,
          60.20097
        ],
        [
          24.80401,
          60.2008
        ],
        [
          24.80397,
          60.20054
        ],
        [
          24.80378,
          60.20018
        ],
        [
          24.8035,
          60.19987
        ],
        [
          24.80328,
          60.19945
        ],
        [
          24.80316,
          60.19919
        ],
        [
          24.80299,
          60.19873
        ],
        [
          24.80293,
          60.19863
        ],
        [
          24.80278,
          60.19845
        ],
        [
          24.80262,
          60.19831
        ],
        [
          24.8024,
          60.19817
        ],
        [
          24.80194,
          60.19798
        ],
        [
          24.80156,
          60.19775
        ],
        [
          24.8013,
          60.19747
        ],
        [
          24.80101,
          60.19727
        ],
        [
          24.80049,
          60.19702
        ],
        [
          24.79993,
          60.19686
        ],
        [
          24.79977,
          60.19676
        ],
        [
          24.79966,
          60.19664
        ],
        [
          24.79954,
          60.19634
        ],
        [
          24.79943,
          60.19625
        ],
        [
          24.79923,
          60.19621
        ],
        [
          24.799,
          60.19626
        ],
        [
          24.79762,
          60.19665
        ],
        [
          24.79746,
          60.19669
        ],
        [
          24.79733,
          60.1967
        ],
        [
          24.79722,
          60.19669
        ],
        [
          24.79706,
          60.19666
        ],
        [
          24.79662,
          60.19651
        ],
        [
          24.79603,
          60.19637
        ],
        [
          24.79572,
          60.19632
        ],
        [
          24.79554,
          60.19629
        ],
        [
          24.79539,
          60.19624
        ],
        [
          24.79517,
          60.19616
        ],
        [
          24.7949,
          60.19605
        ],
        [
          24.79419,
          60.19587
        ],
        [
          24.79401,
          60.1958
        ],
        [
          24.79388,
          60.19571
        ],
        [
          24.79385,
          60.19566
        ],
        [
          24.79381,
          60.19551
        ],
        [
          24.7938,
          60.19545
        ],
        [
          24.79396,
          60.1952
        ],
        [
          24.79427,
          60.19472
        ],
        [
          24.79448,
          60.19447
        ],
        [
          24.79507,
          60.19398
        ],
        [
          24.79517,
          60.19388
        ],
        [
          24.79545,
          60.19358
        ],
        [
          24.79561,
          60.19325
        ],
        [
          24.7958,
          60.19298
        ],
        [
          24.7961,
          60.1926
        ],
        [
          24.79611,
          60.19251
        ],
        [
          24.79609,
          60.1924
        ],
        [
          24.7958,
          60.19212
        ],
        [
          24.79574,
          60.19205
        ],
        [
          24.79576,
          60.192
        ],
        [
          24.79579,
          60.19187
        ],
        [
          24.79593,
          60.19171
        ],
        [
          24.79699,
          60.19073
        ],
        [
          24.79741,
          60.19036
        ],
        [
          24.79748,
          60.1902
        ],
        [
          24.79737,
          60.19007
        ],
        [
          24.79714,
          60.18975
        ],
        [
          24.79701,
          60.18947
        ],
        [
          24.79699,
          60.18924
        ],
        [
          24.79698,
          60.18906
        ],
        [
          24.79702,
          60.18893
        ],
        [
          24.7971,
          60.18877
        ],
        [
          24.79719,
          60.18859
        ],
        [
          24.79735,
          60.1884
        ],
        [
          24.79754,
          60.18819
        ],
        [
          24.79754,
          60.18806
        ],
        [
          24.7975,
          60.18798
        ],
        [
          24.79741,
          60.18782
        ],
        [
          24.79722,
          60.18746
        ],
        [
          24.79686,
          60.18688
        ],
        [
          24.7966,
          60.18643
        ],
        [
          24.79631,
          60.18592
        ],
        [
          24.79586,
          60.18513
        ],
        [
          24.7956,
          60.18473
        ],
        [
          24.7952,
          60.184
        ],
        [
          24.79473,
          60.18318
        ],
        [
          24.79469,
          60.18304
        ],
        [
          24.7947,
          60.18272
        ],
        [
          24.79477,
          60.1825
        ],
        [
          24.79496,
          60.1823
        ],
        [
          24.79544,
          60.18189
        ],
        [
          24.79588,
          60.18156
        ],
        [
          24.79608,
          60.18141
        ],
        [
          24.7968,
          60.18081
        ],
        [
          24.7974,
          60.18031
        ],
        [
          24.79779,
          60.17997
        ],
        [
          24.79813,
          60.17961
        ],
        [
          24.79844,
          60.1792
        ],
        [
          24.79872,
          60.1788
        ],
        [
          24.79894,
          60.17823
        ],
        [
          24.79929,
          60.17766
        ],
        [
          24.79953,
          60.17724
        ],
        [
          24.79984,
          60.17669
        ],
        [
          24.80008,
          60.17627
        ],
        [
          24.80027,
          60.17593
        ],
        [
          24.80041,
          60.17569
        ],
        [
          24.8005,
          60.17548
        ],
        [
          24.80068,
          60.1752
        ],
        [
          24.80106,
          60.17453
        ],
        [
          24.80433,
          60.1749
        ],
        [
          24.80641,
          60.17516
        ],
        [
          24.80828,
          60.17543
        ],
        [
          24.80907,
          60.17559
        ],
        [
          24.80938,
          60.17553
        ],
        [
          24.80963,
          60.17553
        ],
        [
          24.80979,
          60.17557
        ],
        [
          24.8099,
          60.17539
        ],
        [
          24.81002,
          60.17511
        ],
        [
          24.81017,
          60.17476
        ],
        [
          24.81035,
          60.17423
        ],
        [
          24.81045,
          60.17369
        ],
        [
          24.81045,
          60.17363
        ],
        [
          24.81051,
          60.17319
        ],
        [
          24.8105,
          60.17292
        ],
        [
          24.81058,
          60.17154
        ],
        [
          24.81063,
          60.17094
        ],
        [
          24.8107,
          60.17058
        ],
        [
          24.81085,
          60.16999
        ],
        [
          24.81094,
          60.16954
        ],
        [
          24.81105,
          60.16941
        ],
        [
          24.81117,
          60.16936
        ],
        [
          24.81133,
          60.16935
        ],
        [
          24.81189,
          60.1694
        ],
        [
          24.81247,
          60.16946
        ],
        [
          24.81303,
          60.16947
        ],
        [
          24.81456,
          60.16949
        ],
        [
          24.81602,
          60.16942
        ],
        [
          24.81722,
          60.16935
        ],
        [
          24.81967,
          60.16925
        ],
        [
          24.821,
          60.16919
        ],
        [
          24.82261,
          60.16919
        ],
        [
          24.82404,
          60.16911
        ],
        [
          24.82483,
          60.169
        ],
        [
          24.82583,
          60.1689
        ],
        [
          24.82699,
          60.16881
        ],
        [
          24.82857,
          60.16868
        ],
        [
          24.83057,
          60.16843
        ],
        [
          24.83253,
          60.16815
        ],
        [
          24.83437,
          60.16785
        ],
        [
          24.83591,
          60.16752
        ],
        [
          24.83924,
          60.16668
        ],
        [
          24.83945,
          60.16658
        ],
        [
          24.84049,
          60.16627
        ],
        [
          24.84252,
          60.16583
        ],
        [
          24.8442,
          60.16553
        ],
        [
          24.84571,
          60.16535
        ],
        [
          24.85344,
          60.16403
        ],
        [
          24.86013,
          60.16285
        ],
        [
          24.8628,
          60.16244
        ],
        [
          24.86377,
          60.16235
        ],
        [
          24.86416,
          60.16232
        ],
        [
          24.86499,
          60.16229
        ],
        [
          24.86568,
          60.16229
        ],
        [
          24.86622,
          60.16229
        ],
        [
          24.86733,
          60.16233
        ],
        [
          24.86771,
          60.16236
        ],
        [
          24.8682,
          60.16241
        ],
        [
          24.86932,
          60.16255
        ],
        [
          24.87006,
          60.16267
        ],
        [
          24.87135,
          60.16292
        ],
        [
          24.8716,
          60.16298
        ],
        [
          24.87676,
          60.16401
        ],
        [
          24.87781,
          60.16421
        ],
        [
          24.87904,
          60.16444
        ],
        [
          24.88161,
          60.16482
        ],
        [
          24.88237,
          60.16492
        ],
        [
          24.88358,
          60.16508
        ],
        [
          24.88817,
          60.1656
        ],
        [
          24.89937,
          60.16687
        ],
        [
          24.90078,
          60.16698
        ],
        [
          24.90212,
          60.16704
        ],
        [
          24.90257,
          60.16706
        ],
        [
          24.90336,
          60.16705
        ],
        [
          24.90392,
          60.16702
        ],
        [
          24.90514,
          60.16697
        ],
        [
          24.90577,
          60.16691
        ],
        [
          24.90659,
          60.16682
        ],
        [
          24.90751,
          60.16668
        ],
        [
          24.90789,
          60.16663
        ],
        [
          24.90874,
          60.16643
        ],
        [
          24.90919,
          60.16631
        ],
        [
          24.9096,
          60.16619
        ],
        [
          24.91042,
          60.16587
        ],
        [
          24.91096,
          60.1656
        ],
        [
          24.91131,
          60.16539
        ],
        [
          24.91186,
          60.16498
        ],
        [
          24.91207,
          60.16478
        ],
        [
          24.91217,
          60.16465
        ],
        [
          24.91253,
          60.16441
        ],
        [
          24.91402,
          60.16444
        ],
        [
          24.91507,
          60.16448
        ],
        [
          24.91874,
          60.16457
        ],
        [
          24.92119,
          60.16462
        ],
        [
          24.92293,
          60.16478
        ],
        [
          24.9245,
          60.16489
        ],
        [
          24.92481,
          60.16493
        ],
        [
          24.92555,
          60.16503
        ],
        [
          24.92637,
          60.16531
        ],
        [
          24.92657,
          60.16568
        ],
        [
          24.92688,
          60.16627
        ],
        [
          24.92722,
          60.16694
        ],
        [
          24.92764,
          60.16766
        ],
        [
          24.92784,
          60.16794
        ],
        [
          24.92914,
          60.16846
        ],
        [
          24.93012,
          60.1688
        ]
      ]
      mapRef.current.on('load', () => {

        if (mapRef.current.getSource('route')) {
          mapRef.current.removeSource('route');
        }

        mapRef.current.addSource('route', {
          type: 'geojson',
          data: {
            type: 'Feature',
            properties: {},
            geometry: {
              type: 'LineString',
              coordinates: coordinates,
            },
          },
        });

        mapRef.current.addLayer({
          id: 'route',
          type: 'line',
          source: 'route',
          layout: {
            'line-join': 'round',
            'line-cap': 'round',
          },
          paint: {
            'line-color': '#000',
            'line-width': 6,
          },
        });
      });
    }
  }, [points]);

  return (
    <div ref={mapContainer} className="map-container" />
  );
}